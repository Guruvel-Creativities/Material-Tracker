<!DOCTYPE html>
<html>
<head>
  <title>Material Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Scanner -->
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

  <!-- Fixed jsPDF & QRCode -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.4.4/build/qrcode.min.js"></script>

  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    .btn { padding: 10px 15px; margin: 5px; font-size: 16px; }
    .list { margin-top: 20px; }
    .list div { margin: 5px 0; }
  </style>
</head>
<body>
  <button onclick="generateMultipleQRCodes()">ðŸ“„ Generate QR Codes</button>

  <script>
    let lastSerialNum = parseInt(localStorage.getItem('lastSerial') || '0');

    function generateMultipleQRCodes() {
      let count = parseInt(prompt("How many QR codes to generate?"));
      if (isNaN(count) || count <= 0) return;

      const jsPDF = window.jspdf.jsPDF;
      const doc = new jsPDF();
      let margin = 10, size = 40, x = margin, y = margin;
      let perRow = 3, promises = [];

      for (let i = 1; i <= count; i++) {
        let serialNum = lastSerialNum + i;
        let serialId = `ID${serialNum.toString().padStart(3, '0')}`;
        promises.push(
          QRCode.toDataURL(serialId).then(url => {
            doc.addImage(url, 'PNG', x, y, size, size);
            doc.text(serialId, x, y + size + 5);
            x += 60;
            if (i % perRow === 0) {
              x = margin;
              y += 60 + 10;
              if (y + 60 > 280) {
                doc.addPage();
                y = margin;
              }
            }
          })
        );
      }

      Promise.all(promises).then(() => {
        lastSerialNum += count;
        localStorage.setItem('lastSerial', lastSerialNum.toString());
        console.log("PDF ready, downloading...");
        doc.save('qr-codes.pdf');
      });
    }
  </script>
</body>
</html>
